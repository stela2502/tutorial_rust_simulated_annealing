<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Rust Program Logioc is Implemented in “main.rs” | Simulated Annealing in Rust</title>
  <meta name="description" content="<p>This Tutorial gives a short hands on example of how to read a table into Rust and run some calculations.
This should be a one day excercise and requires a previouse programming experience, but not necessarily Rust experience.</p>" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Rust Program Logioc is Implemented in “main.rs” | Simulated Annealing in Rust" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This Tutorial gives a short hands on example of how to read a table into Rust and run some calculations.
This should be a one day excercise and requires a previouse programming experience, but not necessarily Rust experience.</p>" />
  <meta name="github-repo" content="stela2502/tutorial_rust_simulated_annealing" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Rust Program Logioc is Implemented in “main.rs” | Simulated Annealing in Rust" />
  
  <meta name="twitter:description" content="<p>This Tutorial gives a short hands on example of how to read a table into Rust and run some calculations.
This should be a one day excercise and requires a previouse programming experience, but not necessarily Rust experience.</p>" />
  

<meta name="author" content="Stefan Lang" />


<meta name="date" content="2025-04-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="implement-the-simulated-annealing-algorithm.html"/>
<link rel="next" href="error-handling.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html"><i class="fa fa-check"></i><b>1</b> Using Rust to Implement the Simulated Annealing Algorithm</a>
<ul>
<li class="chapter" data-level="1.1" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#rust-vs.-r-key-differences"><i class="fa fa-check"></i><b>1.1</b> Rust vs. R: Key Differences</a></li>
<li class="chapter" data-level="1.2" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#a-quick-refresher-object-oriented-programming-oo"><i class="fa fa-check"></i><b>1.2</b> <strong>A Quick Refresher: Object-Oriented Programming (OO)</strong></a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#r-example-object-oriented-approach-using-s3"><i class="fa fa-check"></i><b>1.2.1</b> <strong>R Example: Object-Oriented Approach Using S3</strong></a></li>
<li class="chapter" data-level="1.2.2" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#rust-equivalent-using-structs-and-traits"><i class="fa fa-check"></i><b>1.2.2</b> <strong>Rust Equivalent: Using Structs and Traits</strong></a></li>
<li class="chapter" data-level="1.2.3" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#key-takeaways"><i class="fa fa-check"></i><b>1.2.3</b> <strong>Key Takeaways</strong></a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#the-problem-clustering-expression-data-using-simulated-annealing"><i class="fa fa-check"></i><b>1.3</b> <strong>The Problem: Clustering Expression Data Using Simulated Annealing</strong></a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#the-data"><i class="fa fa-check"></i><b>1.3.1</b> <strong>The Data</strong></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#simulated-annealing"><i class="fa fa-check"></i><b>1.4</b> Simulated annealing</a></li>
<li class="chapter" data-level="1.5" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#the-algorithm"><i class="fa fa-check"></i><b>1.5</b> The Algorithm</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html"><i class="fa fa-check"></i><b>2</b> Variables - Strict Types and Ownership in Rust</a>
<ul>
<li class="chapter" data-level="2.1" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#strict-types-in-rust"><i class="fa fa-check"></i><b>2.1</b> Strict Types in Rust</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#example-1-strict-typing-in-rust"><i class="fa fa-check"></i><b>2.1.1</b> Example 1: Strict Typing in Rust</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#ownership-in-rust"><i class="fa fa-check"></i><b>2.2</b> Ownership in Rust</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#ownership-rules-in-rust"><i class="fa fa-check"></i><b>2.2.1</b> Ownership Rules in Rust:</a></li>
<li class="chapter" data-level="2.2.2" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#example-2-ownership-in-rust"><i class="fa fa-check"></i><b>2.2.2</b> Example 2: Ownership in Rust</a></li>
<li class="chapter" data-level="2.2.3" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#example-3-borrowing-in-rust"><i class="fa fa-check"></i><b>2.2.3</b> Example 3: Borrowing in Rust</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#combining-types-and-ownership"><i class="fa fa-check"></i><b>2.3</b> Combining Types and Ownership</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#output"><i class="fa fa-check"></i><b>2.3.1</b> Output:</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#summary-of-ownership-and-strict-types"><i class="fa fa-check"></i><b>2.4</b> Summary of Ownership and Strict Types:</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html"><i class="fa fa-check"></i><b>3</b> Create a Rust Project and Implement the Class</a>
<ul>
<li class="chapter" data-level="3.1" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#for-the-class---which-data-structures-do-we-need"><i class="fa fa-check"></i><b>3.1</b> For the class - which data structures do we need?</a></li>
<li class="chapter" data-level="3.2" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#function-overview"><i class="fa fa-check"></i><b>3.2</b> Function Overview</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#function-signature"><i class="fa fa-check"></i><b>3.2.1</b> Function Signature</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#breaking-it-down"><i class="fa fa-check"></i><b>3.3</b> Breaking It Down</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#step-1-open-the-file"><i class="fa fa-check"></i><b>3.3.1</b> Step 1: Open the File</a></li>
<li class="chapter" data-level="3.3.2" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#step-2-prepare-the-variables"><i class="fa fa-check"></i><b>3.3.2</b> Step 2: Prepare the Variables</a></li>
<li class="chapter" data-level="3.3.3" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#step-3-parse-each-line"><i class="fa fa-check"></i><b>3.3.3</b> Step 3: Parse Each Line</a></li>
<li class="chapter" data-level="3.3.4" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#step-4-extract-row-names"><i class="fa fa-check"></i><b>3.3.4</b> Step 4: Extract Row Names</a></li>
<li class="chapter" data-level="3.3.5" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#step-5-convert-remaining-values-to-f32"><i class="fa fa-check"></i><b>3.3.5</b> Step 5: Convert Remaining Values to <code>f32</code></a></li>
<li class="chapter" data-level="3.3.6" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#step-6-return-the-parsed-data"><i class="fa fa-check"></i><b>3.3.6</b> Step 6: Return the Parsed Data</a></li>
<li class="chapter" data-level="3.3.7" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#why-are-there-so-many-ways-to-create-the-error"><i class="fa fa-check"></i><b>3.3.7</b> Why are there so many ways to create the error?</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#adding-a-test-for-read_table_with_names"><i class="fa fa-check"></i><b>3.4</b> Adding a Test for <code>read_table_with_names</code></a></li>
<li class="chapter" data-level="3.5" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#implementing-a-unit-test"><i class="fa fa-check"></i><b>3.5</b> Implementing a Unit Test</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#explanation-2"><i class="fa fa-check"></i><b>3.5.1</b> Explanation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html"><i class="fa fa-check"></i><b>4</b> Implement the Simulated Annealing Algorithm</a>
<ul>
<li class="chapter" data-level="4.1" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#scaling-of-the-data-or-why-scale.01-in-r-is-fundamentally-flawed"><i class="fa fa-check"></i><b>4.1</b> scaling of the data or “why <code>scale.01</code> in R is Fundamentally Flawed”</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#the-r-implementation"><i class="fa fa-check"></i><b>4.1.1</b> The R Implementation</a></li>
<li class="chapter" data-level="4.1.2" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#the-problems-with-scale.01"><i class="fa fa-check"></i><b>4.1.2</b> The Problems with scale.01</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#the-rust-approach"><i class="fa fa-check"></i><b>4.2</b> The Rust Approach</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#why-the-rust-approach-is-better"><i class="fa fa-check"></i><b>4.2.1</b> Why the Rust Approach is Better</a></li>
<li class="chapter" data-level="4.2.2" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#summary"><i class="fa fa-check"></i><b>4.2.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#calculating-cluster-energy"><i class="fa fa-check"></i><b>4.3</b> Calculating Cluster Energy</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#explanation-of-the-r-code"><i class="fa fa-check"></i><b>4.3.1</b> Explanation of the R Code</a></li>
<li class="chapter" data-level="4.3.2" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#how-it-works-in-r"><i class="fa fa-check"></i><b>4.3.2</b> How It Works in R</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#the-rust-implementation"><i class="fa fa-check"></i><b>4.4</b> The Rust Implementation</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#explanation-of-the-rust-code"><i class="fa fa-check"></i><b>4.4.1</b> Explanation of the Rust Code</a></li>
<li class="chapter" data-level="4.4.2" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#how-it-works-in-rust"><i class="fa fa-check"></i><b>4.4.2</b> How It Works in Rust</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#the-main-worker-function"><i class="fa fa-check"></i><b>4.5</b> The main worker function</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#rust-implementation"><i class="fa fa-check"></i><b>4.5.1</b> Rust Implementation</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#and-funtions-to-plot-and-write-the-data"><i class="fa fa-check"></i><b>4.6</b> And Funtions to Plot and Write the Data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rust-program-logioc-is-implemented-in-main.html"><a href="rust-program-logioc-is-implemented-in-main.html"><i class="fa fa-check"></i><b>5</b> Rust Program Logioc is Implemented in “main.rs”</a>
<ul>
<li class="chapter" data-level="5.1" data-path="rust-program-logioc-is-implemented-in-main.html"><a href="rust-program-logioc-is-implemented-in-main.html#we-have-an-executable"><i class="fa fa-check"></i><b>5.1</b> We have an Executable!!</a></li>
<li class="chapter" data-level="5.2" data-path="rust-program-logioc-is-implemented-in-main.html"><a href="rust-program-logioc-is-implemented-in-main.html#implement-a-print-for-our-class"><i class="fa fa-check"></i><b>5.2</b> Implement a ‘print’ for our Class</a></li>
<li class="chapter" data-level="5.3" data-path="rust-program-logioc-is-implemented-in-main.html"><a href="rust-program-logioc-is-implemented-in-main.html#take-home-message"><i class="fa fa-check"></i><b>5.3</b> Take Home Message</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="error-handling.html"><a href="error-handling.html"><i class="fa fa-check"></i><b>6</b> Error Handling in Rust</a>
<ul>
<li class="chapter" data-level="6.1" data-path="error-handling.html"><a href="error-handling.html#unrecoverable-errors-panic"><i class="fa fa-check"></i><b>6.1</b> 1. Unrecoverable Errors (<code>panic!</code>)</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="error-handling.html"><a href="error-handling.html#example"><i class="fa fa-check"></i><b>6.1.1</b> Example:</a></li>
<li class="chapter" data-level="6.1.2" data-path="error-handling.html"><a href="error-handling.html#when-to-use-panic"><i class="fa fa-check"></i><b>6.1.2</b> When to Use <code>panic!()</code></a></li>
<li class="chapter" data-level="6.1.3" data-path="error-handling.html"><a href="error-handling.html#handling-panics-gracefully"><i class="fa fa-check"></i><b>6.1.3</b> Handling Panics Gracefully</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="error-handling.html"><a href="error-handling.html#recoverable-errors-resultt-e"><i class="fa fa-check"></i><b>6.2</b> 2. Recoverable Errors (<code>Result&lt;T, E&gt;</code>)</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="error-handling.html"><a href="error-handling.html#example-1"><i class="fa fa-check"></i><b>6.2.1</b> Example:</a></li>
<li class="chapter" data-level="6.2.2" data-path="error-handling.html"><a href="error-handling.html#resultt-e-explanation"><i class="fa fa-check"></i><b>6.2.2</b> <code>Result&lt;T, E&gt;</code> Explanation</a></li>
<li class="chapter" data-level="6.2.3" data-path="error-handling.html"><a href="error-handling.html#common-ways-to-handle-resultt-e"><i class="fa fa-check"></i><b>6.2.3</b> Common Ways to Handle <code>Result&lt;T, E&gt;</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="error-handling.html"><a href="error-handling.html#custom-errors-with-thiserror-and-anyhow"><i class="fa fa-check"></i><b>6.3</b> 3. Custom Errors with <code>thiserror</code> and <code>anyhow</code></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="error-handling.html"><a href="error-handling.html#using-thiserror-for-custom-errors"><i class="fa fa-check"></i><b>6.3.1</b> Using <code>thiserror</code> for Custom Errors</a></li>
<li class="chapter" data-level="6.3.2" data-path="error-handling.html"><a href="error-handling.html#using-anyhow-for-simpler-error-handling"><i class="fa fa-check"></i><b>6.3.2</b> Using <code>anyhow</code> for Simpler Error Handling</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="error-handling.html"><a href="error-handling.html#summary-of-rust-error-handling-techniques"><i class="fa fa-check"></i><b>6.4</b> Summary of Rust Error Handling Techniques</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="testing.html"><a href="testing.html"><i class="fa fa-check"></i><b>7</b> Testing in Rust</a>
<ul>
<li class="chapter" data-level="7.1" data-path="testing.html"><a href="testing.html#writing-basic-unit-tests"><i class="fa fa-check"></i><b>7.1</b> 1. Writing Basic Unit Tests</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="testing.html"><a href="testing.html#example-2"><i class="fa fa-check"></i><b>7.1.1</b> Example:</a></li>
<li class="chapter" data-level="7.1.2" data-path="testing.html"><a href="testing.html#common-assertions"><i class="fa fa-check"></i><b>7.1.2</b> Common Assertions:</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="testing.html"><a href="testing.html#running-tests"><i class="fa fa-check"></i><b>7.2</b> 2. Running Tests</a></li>
<li class="chapter" data-level="7.3" data-path="testing.html"><a href="testing.html#testing-for-panics"><i class="fa fa-check"></i><b>7.3</b> 3. Testing for Panics</a></li>
<li class="chapter" data-level="7.4" data-path="testing.html"><a href="testing.html#using-resultt-e-in-tests"><i class="fa fa-check"></i><b>7.4</b> 4. Using <code>Result&lt;T, E&gt;</code> in Tests</a></li>
<li class="chapter" data-level="7.5" data-path="testing.html"><a href="testing.html#ignoring-tests"><i class="fa fa-check"></i><b>7.5</b> 5. Ignoring Tests</a></li>
<li class="chapter" data-level="7.6" data-path="testing.html"><a href="testing.html#benchmarking-with-bench"><i class="fa fa-check"></i><b>7.6</b> 6. Benchmarking with <code>#[bench]</code></a></li>
<li class="chapter" data-level="7.7" data-path="testing.html"><a href="testing.html#integration-tests"><i class="fa fa-check"></i><b>7.7</b> 7. Integration Tests</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="testing.html"><a href="testing.html#example-testsintegration_test.rs"><i class="fa fa-check"></i><b>7.7.1</b> Example <code>tests/integration_test.rs</code>:</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="testing.html"><a href="testing.html#testing-the-executable"><i class="fa fa-check"></i><b>7.8</b> 8. Testing the Executable</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="testing.html"><a href="testing.html#example-teststest_binary.rs"><i class="fa fa-check"></i><b>7.8.1</b> Example <code>tests/test_binary.rs</code>:</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="testing.html"><a href="testing.html#summary-1"><i class="fa fa-check"></i><b>7.9</b> Summary</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Simulated Annealing in Rust</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rust-program-logioc-is-implemented-in-main.rs" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Rust Program Logioc is Implemented in “main.rs”<a href="rust-program-logioc-is-implemented-in-main.html#rust-program-logioc-is-implemented-in-main.rs" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>If you compile the library as it is you will not be able to use it.
We need to implement the main.rs file that codes for the binary.</p>
<p>The R version of what we implement here is this:</p>
<pre><code>
ycc &lt;- read.delim(&quot;../Spellman_Yeast_Cell_Cycle.tsv&quot;,row.names=1,header=T,sep=&quot;\t&quot;)
ycc &lt;- as.matrix(ycc)
ycc.01 &lt;- t(apply(ycc,1,scale.01))




system.time(proc.time(clus &lt;- sa.ok(ycc.01,10,25000,20,0.995)))

# plot the clusters using base R
par(mfrow=c(3,4))

for(i in 1:max(clus)){
  
  ycc.c &lt;- ycc.01[which(clus==i),]
  plot(ycc.c[1,],ty=&quot;l&quot;,ylim=range(ycc.c))
  apply(ycc.c,1,lines)
  
}</code></pre>
<p>But as we implement this functionality as executable it would be better to not hardcode the options:</p>
<p>Command line options are normally parsed using the clap crate so we should add that to our project.
This time I want a specific version:</p>
<pre><code>cargo add clap@3.0.14 --features derive</code></pre>
<p>We need to get the input table, the separating char for that table, the number of clusters to search for, the starting temperature, cool-down factor and max iterations to run through as well as the file we want to save the clusters to. In Rust you would do this like that:</p>
<pre><code>use clap::Parser;

#[derive(Parser)]
#[clap(version = &quot;1.0.0&quot;, author = &quot;Stefan L. &lt;stefan.lang@med.lu.se&gt;&quot;)]
struct Opts {
    /// the input text table
    #[clap(short, long)]
    file: String,
    /// the column separator for the file
    #[clap(default_value= &quot;\\t&quot;,short, long)]
    sep: String,
    /// the number of clusters
    #[clap(short, long)]
    clusters: usize,
    /// the starting temperature
    #[clap(default_value_t= 20.0,short, long)]
    temp: f32,
    /// the cooling factor
    #[clap(default_value_t= 0.9995,short, long)]
    cool: f32,
    ///max number of iterations
    #[clap(default_value_t= 1000*1000,short, long)]
    max_it: usize,
    /// the grouping outfile
    #[clap(short, long)]
    outfile: String,
}</code></pre>
<p>Here’s a breakdown of what it’s doing:</p>
<ol style="list-style-type: decimal">
<li><p><strong>use clap::Parser;:</strong> This imports the necessary functionality from the clap crate, which is used for parsing command-line arguments.</p></li>
<li><p><strong>#[derive(Parser)]:</strong> This macro automatically implements the Parser trait for the Opts struct. This allows the struct to be used for argument parsing in the CLI.</p></li>
<li><p><strong>#[clap(version = “1.0.0”, author = “Stefan L. <a href="mailto:stefan.lang@med.lu.se" class="email">stefan.lang@med.lu.se</a>”)]:</strong> This defines metadata for the program such as its version and author, which will be shown when the user runs the command with a –version or –help flag.</p></li>
<li><p><strong>struct Opts { … }:</strong> The Opts struct holds the various command-line arguments that the program will accept.
Each three lines corresponds to a command-line argument with hep srting, options and variable definition.</p></li>
</ol>
<p>The different clap options we are using here mean</p>
<ul>
<li><strong>short</strong> use the variable names first character for a short option like -f for file</li>
<li><strong>long</strong> use the variable name as long option line –file for file</li>
<li><strong>default_value</strong> the default String value if the user does not specify one</li>
<li><strong>default_value_t</strong> used for default values that are not a String</li>
</ul>
<p>The main function is quite simple — half of it is just calculating the time taken for the program to execute. Give it a try!</p>
<pre><code>use std::time::SystemTime;
// this is specific for my package which I have called simulated_annealing_new as I had an other version, too.
use simulated_annealing::SimulatedAnnealing;

fn main() {
    let now = SystemTime::now();
    
    let opts: Opts = Opts::parse();

    let mut sep = &#39;\t&#39;;
    if &amp;opts.sep != &quot;\\t&quot;{
        //println!(&quot;I set sep to {}&quot;, opts.sep );
        sep = opts.sep.chars().next().unwrap(); 
    }

    let mut sim = SimulatedAnnealing::new( &amp;opts.file, opts.clusters, opts.temp, sep );
    sim.scale_01();    

    //println!(&quot;Initial state: {sim}&quot;);

    let iterations = sim.run( opts.max_it, opts.cool );

    let _= sim.plot( &amp;opts.outfile );

    //println!(&quot;Final state {sim} in {iterations} iterations&quot;);

    match sim.write_clusters( &amp;opts.outfile, sep ){
        Ok(_) =&gt; println!(&quot;Clusters written to {}&quot;, &amp;opts.outfile ),
        Err(e) =&gt; eprintln!(&quot;Failed to write the data to {}: {:?}&quot;, &amp;opts.outfile, e),
    }

    match now.elapsed() {
        Ok(elapsed) =&gt; {
            let mut milli = elapsed.as_millis();

            let mil = milli % 1000;
            milli= (milli - mil) /1000;

            let sec = milli % 60;
            milli= (milli -sec) /60;

            let min = milli % 60;
            milli= (milli -min) /60;

            eprintln!(&quot;finished in {milli} h {min} min {sec} sec {mil} milli sec&quot;);
        },
        Err(e) =&gt; {println!(&quot;Error: {e:?}&quot;);}
    }
}
</code></pre>
<p>Now compile and test it:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb47-1"><a href="rust-program-logioc-is-implemented-in-main.html#cb47-1" tabindex="-1"></a><span class="ex">cargo</span> test <span class="at">-r</span></span></code></pre></div>
<pre><code>## make[1]: Verzeichnis „/home/med-sal/git_Projects/tutorial_rust_simulated_annealing“ wird betreten
## Building /home/med-sal/git_Projects/tutorial_rust_simulated_annealing/rust_stages/step4...
## warning: unused variable: `iterations`
##   --&gt; src/main.rs:48:9
##    |
## 48 |     let iterations = sim.run( opts.max_it, opts.cool );
##    |         ^^^^^^^^^^ help: if this is intentional, prefix it with an underscore: `_iterations`
##    |
##    = note: `#[warn(unused_variables)]` on by default
## 
## warning: `simulated_annealing` (bin &quot;simulated_annealing&quot;) generated 1 warning
## warning: `simulated_annealing` (bin &quot;simulated_annealing&quot; test) generated 1 warning (1 duplicate)
##     Finished `release` profile [optimized] target(s) in 0.04s
##      Running unittests src/lib.rs (target/release/deps/simulated_annealing-ec0f849373011f09)
## 
## running 2 tests
## test tests::tes_scale01 ... ok
## test tests::test_read_data ... ok
## 
## test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
## 
##      Running unittests src/main.rs (target/release/deps/simulated_annealing-34887cf23462f205)
## 
## running 0 tests
## 
## test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
## 
##      Running tests/test-SimulatedAnnealing.rs (target/release/deps/test_SimulatedAnnealing-fd16fac0ecee9aa3)
## 
## running 1 test
## test test_simulated_annealing ... ok
## 
## test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
## 
##    Doc-tests simulated_annealing
## 
## running 0 tests
## 
## test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
## 
## Finished building /home/med-sal/git_Projects/tutorial_rust_simulated_annealing/rust_stages/step4. Logs are in step4_build.log
## make[1]: Verzeichnis „/home/med-sal/git_Projects/tutorial_rust_simulated_annealing“ wird verlassen</code></pre>
<div id="we-have-an-executable" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> We have an Executable!!<a href="rust-program-logioc-is-implemented-in-main.html#we-have-an-executable" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You now can run the executable target/release/simulated_annealing like that:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb49-1"><a href="rust-program-logioc-is-implemented-in-main.html#cb49-1" tabindex="-1"></a><span class="ex">target/release/simulated_annealing</span>  <span class="at">-f</span> tests/data/Spellman_Yeast_Cell_Cycle.tsv <span class="at">--clusters</span> 8 <span class="at">--temp</span> 20 <span class="at">--outfile</span> /tmp/clusters.tsv</span></code></pre></div>
<pre><code>## Saved: /tmp/clusters.tsv_cluster_1.png
## Saved: /tmp/clusters.tsv_cluster_2.png
## Saved: /tmp/clusters.tsv_cluster_3.png
## Saved: /tmp/clusters.tsv_cluster_4.png
## Saved: /tmp/clusters.tsv_cluster_5.png
## Saved: /tmp/clusters.tsv_cluster_6.png
## Saved: /tmp/clusters.tsv_cluster_7.png
## Saved: /tmp/clusters.tsv_cluster_8.png
## Saved: /tmp/clusters.tsv_cluster_9.png
## Saved: /tmp/clusters.tsv_cluster_10.png
## Clusters written to /tmp/clusters.tsv
## finished in 0 h 0 min 0 sec 191 milli sec</code></pre>
</div>
<div id="implement-a-print-for-our-class" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Implement a ‘print’ for our Class<a href="rust-program-logioc-is-implemented-in-main.html#implement-a-print-for-our-class" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The output from our simulation is missing key information — we want to display the system’s energy before and after processing.</p>
<p>In an R S3 class, we would implement a custom print method like this:</p>
<p>SCRIPTr
print.simulatedAnnealing &lt;- function(x) {
# Format and display info about x
}
SCRIPT</p>
<p>This allows you to simply call <code>print(x)</code> and get a meaningful summary of the object.</p>
<p>Rust doesn’t have classical inheritance like R’s S3/S4 or R6 systems. Instead, Rust uses <strong>traits</strong>, which act like interfaces or capabilities. A type can implement a trait to gain specific behavior — similar to adding methods in R.</p>
<p>To define a custom print format in Rust, we implement the <code>Display</code> trait:</p>
<p>SCRIPTrust
use std::fmt;</p>
<p>impl fmt::Display for SimulatedAnnealing {
fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;’_&gt;) -&gt; fmt::Result {
let mut sum = 0.0_f32;
for i in 0..self.k {
sum += self.calc_ek(i);
}
sum /= self.k as f32;
write!(
f,
“SimulatedAnnealing (temperature: {:.2}, total energy: {:.2} for {} clusters)”,
self.temp, sum, self.k
)
}
}
SCRIPT</p>
<p>This gives the struct a user-friendly string representation, just like implementing <code>print()</code> for a class in R.</p>
<p>Afterwards we can change our main.rs and add the print statements:</p>
<pre><code>fn main() {
    let now = SystemTime::now();
    
    let opts: Opts = Opts::parse();

    let mut sep = &#39;\t&#39;;
    if &amp;opts.sep != &quot;\\t&quot;{
        //println!(&quot;I set sep to {}&quot;, opts.sep );
        sep = opts.sep.chars().next().unwrap(); 
    }

    let mut sim = SimulatedAnnealing::new( &amp;opts.file, opts.clusters, opts.temp, sep );
    sim.scale_01();    

    println!(&quot;Initial state: {sim}&quot;);

    let iterations = sim.run( opts.max_it, opts.cool );

    let _= sim.plot( &amp;opts.outfile );

    println!(&quot;Final state {sim} after {iterations} iterations&quot;);

    match sim.write_clusters( &amp;opts.outfile, sep ){
        Ok(_) =&gt; println!(&quot;Clusters written to {}&quot;, &amp;opts.outfile ),
        Err(e) =&gt; eprintln!(&quot;Failed to write the data to {}: {:?}&quot;, &amp;opts.outfile, e),
    }

    match now.elapsed() {
        Ok(elapsed) =&gt; {
            let mut milli = elapsed.as_millis();

            let mil = milli % 1000;
            milli= (milli - mil) /1000;

            let sec = milli % 60;
            milli= (milli -sec) /60;

            let min = milli % 60;
            milli= (milli -min) /60;

            eprintln!(&quot;finished in {milli} h {min} min {sec} sec {mil} milli sec&quot;);
        },
        Err(e) =&gt; {println!(&quot;Error: {e:?}&quot;);}
    }
}</code></pre>
<p>I have not modified my examples here - so this is something you can do all for yourself.
If we have more time we could implement one more improvement to the library:</p>
<p>Add a store variable into the class and populate it with the row to row distances after you have scaled the data.
Then modify the calc_ek() function to use the values from the store and not calculate the distances every single time.
This should give you an additional x5 speed improvement if you store it as a Vec&lt;Vec<f32>&gt; again. If you use a single vector and an index function you could get an even better performance.</p>
</div>
<div id="take-home-message" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Take Home Message<a href="rust-program-logioc-is-implemented-in-main.html#take-home-message" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The implementation of the functions is significantly different from R or Python, but with the compiler and the AI assistance we can get at the moment it, is doable. Coding in Rust takes time to get into, but the speed improvements can be worth it.</p>
<p>This example here does not really highlight the usability as the R code also finished in a reasonable amount of time, but if you have more complicated tasks - like processing BAM files or anything else that is (1) either easy to implement in a multiprocessor system or (2) needs to process binary data, it is worth to look into Rust. It is somewhat slower than C and C++ (like 3 to 5 times?), but Rust is so much easier to program in if you come from R and Python - it is worth it.</p>
<p>By the way - I used a ArrayBase&lt;ndarray::OwnedRepr<f64>, Dim&lt;[usize; 2]&gt;&gt; for my store and gained another speed boost of factor 2. Given the fact that this takes either 60 or 30 milliseconds this is no big deal. For the sake of this tutorial I think a Vec&lt;Vec&lt;_&gt;&gt; is easier to work with. You can check out my other implementation <a href="https://github.com/stela2502/simulated_annealing">here</a>.</p>
<p><a href="implement-the-simulated-annealing-algorithm.html" class="btn" id="prev">⬅️ Previous</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="implement-the-simulated-annealing-algorithm.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="error-handling.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/USERNAME/REPO/edit/BRANCH/05-the_binary.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf", "_main.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
