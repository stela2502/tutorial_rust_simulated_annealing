<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Simulated Annealing in Rust</title>
  <meta name="description" content="<p>This Tutorial gives a short hands on example of how to read a table into Rust and run some calculations.
This should be a one day excercise and requires a previouse programming experience, but not necessarily Rust experience.</p>" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Simulated Annealing in Rust" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This Tutorial gives a short hands on example of how to read a table into Rust and run some calculations.
This should be a one day excercise and requires a previouse programming experience, but not necessarily Rust experience.</p>" />
  <meta name="github-repo" content="stela2502/tutorial_rust_simulated_annealing" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Simulated Annealing in Rust" />
  
  <meta name="twitter:description" content="<p>This Tutorial gives a short hands on example of how to read a table into Rust and run some calculations.
This should be a one day excercise and requires a previouse programming experience, but not necessarily Rust experience.</p>" />
  

<meta name="author" content="Stefan Lang" />


<meta name="date" content="2025-04-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  

<link rel="next" href="variables---strict-types-and-ownership-in-rust.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html"><i class="fa fa-check"></i><b>1</b> Using Rust to Implement the Simulated Annealing Algorithm</a>
<ul>
<li class="chapter" data-level="1.1" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#rust-vs.-r-key-differences"><i class="fa fa-check"></i><b>1.1</b> Rust vs.Â R: Key Differences</a></li>
<li class="chapter" data-level="1.2" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#a-quick-refresher-object-oriented-programming-oo"><i class="fa fa-check"></i><b>1.2</b> <strong>A Quick Refresher: Object-Oriented Programming (OO)</strong></a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#r-example-object-oriented-approach-using-s3"><i class="fa fa-check"></i><b>1.2.1</b> <strong>R Example: Object-Oriented Approach Using S3</strong></a></li>
<li class="chapter" data-level="1.2.2" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#rust-equivalent-using-structs-and-traits"><i class="fa fa-check"></i><b>1.2.2</b> <strong>Rust Equivalent: Using Structs and Traits</strong></a></li>
<li class="chapter" data-level="1.2.3" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#key-takeaways"><i class="fa fa-check"></i><b>1.2.3</b> <strong>Key Takeaways</strong></a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#the-problem-clustering-expression-data-using-simulated-annealing"><i class="fa fa-check"></i><b>1.3</b> <strong>The Problem: Clustering Expression Data Using Simulated Annealing</strong></a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#the-data"><i class="fa fa-check"></i><b>1.3.1</b> <strong>The Data</strong></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#simulated-annealing"><i class="fa fa-check"></i><b>1.4</b> Simulated annealing</a></li>
<li class="chapter" data-level="1.5" data-path="using-rust-to-implement-the-simulated-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#the-algorithm"><i class="fa fa-check"></i><b>1.5</b> The Algorithm</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html"><i class="fa fa-check"></i><b>2</b> Variables - Strict Types and Ownership in Rust</a>
<ul>
<li class="chapter" data-level="2.1" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#strict-types-in-rust"><i class="fa fa-check"></i><b>2.1</b> Strict Types in Rust</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#example-1-strict-typing-in-rust"><i class="fa fa-check"></i><b>2.1.1</b> Example 1: Strict Typing in Rust</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#ownership-in-rust"><i class="fa fa-check"></i><b>2.2</b> Ownership in Rust</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#ownership-rules-in-rust"><i class="fa fa-check"></i><b>2.2.1</b> Ownership Rules in Rust:</a></li>
<li class="chapter" data-level="2.2.2" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#example-2-ownership-in-rust"><i class="fa fa-check"></i><b>2.2.2</b> Example 2: Ownership in Rust</a></li>
<li class="chapter" data-level="2.2.3" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#example-3-borrowing-in-rust"><i class="fa fa-check"></i><b>2.2.3</b> Example 3: Borrowing in Rust</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#combining-types-and-ownership"><i class="fa fa-check"></i><b>2.3</b> Combining Types and Ownership</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#output"><i class="fa fa-check"></i><b>2.3.1</b> Output:</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="variables---strict-types-and-ownership-in-rust.html"><a href="variables---strict-types-and-ownership-in-rust.html#summary-of-ownership-and-strict-types"><i class="fa fa-check"></i><b>2.4</b> Summary of Ownership and Strict Types:</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html"><i class="fa fa-check"></i><b>3</b> Create a Rust Project and Implement the Class</a>
<ul>
<li class="chapter" data-level="3.1" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#for-the-class---which-data-structures-do-we-need"><i class="fa fa-check"></i><b>3.1</b> For the class - which data structures do we need?</a></li>
<li class="chapter" data-level="3.2" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#function-overview"><i class="fa fa-check"></i><b>3.2</b> Function Overview</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#function-signature"><i class="fa fa-check"></i><b>3.2.1</b> Function Signature</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#breaking-it-down"><i class="fa fa-check"></i><b>3.3</b> Breaking It Down</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#step-1-open-the-file"><i class="fa fa-check"></i><b>3.3.1</b> Step 1: Open the File</a></li>
<li class="chapter" data-level="3.3.2" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#step-2-prepare-the-variables"><i class="fa fa-check"></i><b>3.3.2</b> Step 2: Prepare the Variables</a></li>
<li class="chapter" data-level="3.3.3" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#step-3-parse-each-line"><i class="fa fa-check"></i><b>3.3.3</b> Step 3: Parse Each Line</a></li>
<li class="chapter" data-level="3.3.4" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#step-4-extract-row-names"><i class="fa fa-check"></i><b>3.3.4</b> Step 4: Extract Row Names</a></li>
<li class="chapter" data-level="3.3.5" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#step-5-convert-remaining-values-to-f32"><i class="fa fa-check"></i><b>3.3.5</b> Step 5: Convert Remaining Values to <code>f32</code></a></li>
<li class="chapter" data-level="3.3.6" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#step-6-return-the-parsed-data"><i class="fa fa-check"></i><b>3.3.6</b> Step 6: Return the Parsed Data</a></li>
<li class="chapter" data-level="3.3.7" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#why-are-there-so-many-ways-to-create-the-error"><i class="fa fa-check"></i><b>3.3.7</b> Why are there so many ways to create the error?</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#adding-a-test-for-read_table_with_names"><i class="fa fa-check"></i><b>3.4</b> Adding a Test for <code>read_table_with_names</code></a></li>
<li class="chapter" data-level="3.5" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#implementing-a-unit-test"><i class="fa fa-check"></i><b>3.5</b> Implementing a Unit Test</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="create-a-rust-project-and-implement-the-class.html"><a href="create-a-rust-project-and-implement-the-class.html#explanation-2"><i class="fa fa-check"></i><b>3.5.1</b> Explanation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html"><i class="fa fa-check"></i><b>4</b> Implement the Simulated Annealing Algorithm</a>
<ul>
<li class="chapter" data-level="4.1" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#scaling-of-the-data-or-why-scale.01-in-r-is-fundamentally-flawed"><i class="fa fa-check"></i><b>4.1</b> scaling of the data or âwhy <code>scale.01</code> in R is Fundamentally Flawedâ</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#the-r-implementation"><i class="fa fa-check"></i><b>4.1.1</b> The R Implementation</a></li>
<li class="chapter" data-level="4.1.2" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#the-problems-with-scale.01"><i class="fa fa-check"></i><b>4.1.2</b> The Problems with scale.01</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#the-rust-approach"><i class="fa fa-check"></i><b>4.2</b> The Rust Approach</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#why-the-rust-approach-is-better"><i class="fa fa-check"></i><b>4.2.1</b> Why the Rust Approach is Better</a></li>
<li class="chapter" data-level="4.2.2" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#summary"><i class="fa fa-check"></i><b>4.2.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#calculating-cluster-energy"><i class="fa fa-check"></i><b>4.3</b> Calculating Cluster Energy</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#explanation-of-the-r-code"><i class="fa fa-check"></i><b>4.3.1</b> Explanation of the R Code</a></li>
<li class="chapter" data-level="4.3.2" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#how-it-works-in-r"><i class="fa fa-check"></i><b>4.3.2</b> How It Works in R</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#the-rust-implementation"><i class="fa fa-check"></i><b>4.4</b> The Rust Implementation</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#explanation-of-the-rust-code"><i class="fa fa-check"></i><b>4.4.1</b> Explanation of the Rust Code</a></li>
<li class="chapter" data-level="4.4.2" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#how-it-works-in-rust"><i class="fa fa-check"></i><b>4.4.2</b> How It Works in Rust</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#the-main-worker-function"><i class="fa fa-check"></i><b>4.5</b> The main worker function</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#rust-implementation"><i class="fa fa-check"></i><b>4.5.1</b> Rust Implementation</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="implement-the-simulated-annealing-algorithm.html"><a href="implement-the-simulated-annealing-algorithm.html#and-funtions-to-plot-and-write-the-data"><i class="fa fa-check"></i><b>4.6</b> And Funtions to Plot and Write the Data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rust-program-logioc-is-implemented-in-main.html"><a href="rust-program-logioc-is-implemented-in-main.html"><i class="fa fa-check"></i><b>5</b> Rust Program Logioc is Implemented in âmain.rsâ</a>
<ul>
<li class="chapter" data-level="5.1" data-path="rust-program-logioc-is-implemented-in-main.html"><a href="rust-program-logioc-is-implemented-in-main.html#we-have-an-executable"><i class="fa fa-check"></i><b>5.1</b> We have an Executable!!</a></li>
<li class="chapter" data-level="5.2" data-path="rust-program-logioc-is-implemented-in-main.html"><a href="rust-program-logioc-is-implemented-in-main.html#implement-a-print-for-our-class"><i class="fa fa-check"></i><b>5.2</b> Implement a âprintâ for our Class</a></li>
<li class="chapter" data-level="5.3" data-path="rust-program-logioc-is-implemented-in-main.html"><a href="rust-program-logioc-is-implemented-in-main.html#take-home-message"><i class="fa fa-check"></i><b>5.3</b> Take Home Message</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="error-handling.html"><a href="error-handling.html"><i class="fa fa-check"></i><b>6</b> Error Handling in Rust</a>
<ul>
<li class="chapter" data-level="6.1" data-path="error-handling.html"><a href="error-handling.html#unrecoverable-errors-panic"><i class="fa fa-check"></i><b>6.1</b> 1. Unrecoverable Errors (<code>panic!</code>)</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="error-handling.html"><a href="error-handling.html#example"><i class="fa fa-check"></i><b>6.1.1</b> Example:</a></li>
<li class="chapter" data-level="6.1.2" data-path="error-handling.html"><a href="error-handling.html#when-to-use-panic"><i class="fa fa-check"></i><b>6.1.2</b> When to Use <code>panic!()</code></a></li>
<li class="chapter" data-level="6.1.3" data-path="error-handling.html"><a href="error-handling.html#handling-panics-gracefully"><i class="fa fa-check"></i><b>6.1.3</b> Handling Panics Gracefully</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="error-handling.html"><a href="error-handling.html#recoverable-errors-resultt-e"><i class="fa fa-check"></i><b>6.2</b> 2. Recoverable Errors (<code>Result&lt;T, E&gt;</code>)</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="error-handling.html"><a href="error-handling.html#example-1"><i class="fa fa-check"></i><b>6.2.1</b> Example:</a></li>
<li class="chapter" data-level="6.2.2" data-path="error-handling.html"><a href="error-handling.html#resultt-e-explanation"><i class="fa fa-check"></i><b>6.2.2</b> <code>Result&lt;T, E&gt;</code> Explanation</a></li>
<li class="chapter" data-level="6.2.3" data-path="error-handling.html"><a href="error-handling.html#common-ways-to-handle-resultt-e"><i class="fa fa-check"></i><b>6.2.3</b> Common Ways to Handle <code>Result&lt;T, E&gt;</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="error-handling.html"><a href="error-handling.html#custom-errors-with-thiserror-and-anyhow"><i class="fa fa-check"></i><b>6.3</b> 3. Custom Errors with <code>thiserror</code> and <code>anyhow</code></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="error-handling.html"><a href="error-handling.html#using-thiserror-for-custom-errors"><i class="fa fa-check"></i><b>6.3.1</b> Using <code>thiserror</code> for Custom Errors</a></li>
<li class="chapter" data-level="6.3.2" data-path="error-handling.html"><a href="error-handling.html#using-anyhow-for-simpler-error-handling"><i class="fa fa-check"></i><b>6.3.2</b> Using <code>anyhow</code> for Simpler Error Handling</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="error-handling.html"><a href="error-handling.html#summary-of-rust-error-handling-techniques"><i class="fa fa-check"></i><b>6.4</b> Summary of Rust Error Handling Techniques</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="testing.html"><a href="testing.html"><i class="fa fa-check"></i><b>7</b> Testing in Rust</a>
<ul>
<li class="chapter" data-level="7.1" data-path="testing.html"><a href="testing.html#writing-basic-unit-tests"><i class="fa fa-check"></i><b>7.1</b> 1. Writing Basic Unit Tests</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="testing.html"><a href="testing.html#example-2"><i class="fa fa-check"></i><b>7.1.1</b> Example:</a></li>
<li class="chapter" data-level="7.1.2" data-path="testing.html"><a href="testing.html#common-assertions"><i class="fa fa-check"></i><b>7.1.2</b> Common Assertions:</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="testing.html"><a href="testing.html#running-tests"><i class="fa fa-check"></i><b>7.2</b> 2. Running Tests</a></li>
<li class="chapter" data-level="7.3" data-path="testing.html"><a href="testing.html#testing-for-panics"><i class="fa fa-check"></i><b>7.3</b> 3. Testing for Panics</a></li>
<li class="chapter" data-level="7.4" data-path="testing.html"><a href="testing.html#using-resultt-e-in-tests"><i class="fa fa-check"></i><b>7.4</b> 4. Using <code>Result&lt;T, E&gt;</code> in Tests</a></li>
<li class="chapter" data-level="7.5" data-path="testing.html"><a href="testing.html#ignoring-tests"><i class="fa fa-check"></i><b>7.5</b> 5. Ignoring Tests</a></li>
<li class="chapter" data-level="7.6" data-path="testing.html"><a href="testing.html#benchmarking-with-bench"><i class="fa fa-check"></i><b>7.6</b> 6. Benchmarking with <code>#[bench]</code></a></li>
<li class="chapter" data-level="7.7" data-path="testing.html"><a href="testing.html#integration-tests"><i class="fa fa-check"></i><b>7.7</b> 7. Integration Tests</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="testing.html"><a href="testing.html#example-testsintegration_test.rs"><i class="fa fa-check"></i><b>7.7.1</b> Example <code>tests/integration_test.rs</code>:</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="testing.html"><a href="testing.html#testing-the-executable"><i class="fa fa-check"></i><b>7.8</b> 8. Testing the Executable</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="testing.html"><a href="testing.html#example-teststest_binary.rs"><i class="fa fa-check"></i><b>7.8.1</b> Example <code>tests/test_binary.rs</code>:</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="testing.html"><a href="testing.html#summary-1"><i class="fa fa-check"></i><b>7.9</b> Summary</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Simulated Annealing in Rust</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Simulated Annealing in Rust</h1>
<p class="author"><em>Stefan Lang</em></p>
<p class="date"><em>2025-04-11</em></p>
</div>
<div id="using-rust-to-implement-the-simulated-annealing-algorithm" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">Chapter 1</span> Using Rust to Implement the Simulated Annealing Algorithm<a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#using-rust-to-implement-the-simulated-annealing-algorithm" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This tutorial is for experienced bioinformaticians who have been programming in R and/or Python, or other scripting languages. If you have experience with C, C++, or Julia, that will also be beneficial.</p>
<p>While R is widely used in bioinformatics for statistical analysis and data manipulation, Rust is a <strong>systems programming language</strong> that provides <strong>strong type safety, memory safety without garbage collection</strong>, and <strong>high performance</strong>. This tutorial will introduce key differences between R and Rust and guide you through implementing a simulated annealing algorithm in Rust.</p>
<hr />
<div id="rust-vs.-r-key-differences" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Rust vs.Â R: Key Differences<a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#rust-vs.-r-key-differences" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before diving into the implementation, letâs highlight a few <strong>fundamental differences between R and Rust</strong> that will be important for this tutorial:</p>
<table>
<colgroup>
<col width="21%" />
<col width="42%" />
<col width="36%" />
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>R (Scripting Language)</th>
<th>Rust (Systems Language)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Typing</strong></td>
<td>Dynamic (e.g., <code>x &lt;- 10</code> can later be <code>x &lt;- "text"</code>)</td>
<td>Static (types must be defined, e.g., <code>let x: i32 = 10;</code>)</td>
</tr>
<tr class="even">
<td><strong>Memory Management</strong></td>
<td>Garbage collection</td>
<td>Ownership and borrowing</td>
</tr>
<tr class="odd">
<td><strong>Performance</strong></td>
<td>Optimized for high-level analysis</td>
<td>Compiled, low-level efficiency</td>
</tr>
<tr class="even">
<td><strong>Object-Oriented Features</strong></td>
<td>R has S3, S4, and R6 classes but isnât purely OO</td>
<td>Rust supports structs and traits for OO-like behavior</td>
</tr>
<tr class="odd">
<td><strong>Concurrency</strong></td>
<td>Limited parallel processing</td>
<td>Strong concurrency model with <code>async</code> and threads</td>
</tr>
</tbody>
</table>
<p>Understanding these differences will help when translating concepts from R to Rust.</p>
<hr />
</div>
<div id="a-quick-refresher-object-oriented-programming-oo" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> <strong>A Quick Refresher: Object-Oriented Programming (OO)</strong><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#a-quick-refresher-object-oriented-programming-oo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Although <strong>R is not strictly an object-oriented language</strong>, it does support OO through <strong>S3, S4, and R6 classes</strong>. Rust, on the other hand, does not have traditional classes like Python or Java but instead <strong>uses structs and traits</strong> to achieve similar functionality.</p>
<p>Hereâs a quick comparison of how <strong>objects and methods</strong> are implemented in R and Rust:</p>
<div id="r-example-object-oriented-approach-using-s3" class="section level3 hasAnchor" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> <strong>R Example: Object-Oriented Approach Using S3</strong><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#r-example-object-oriented-approach-using-s3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb1-1" tabindex="-1"></a><span class="co"># Define an S3 object</span></span>
<span id="cb1-2"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb1-2" tabindex="-1"></a>cluster <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">centroid =</span> <span class="fu">c</span>(<span class="fl">2.3</span>, <span class="fl">3.4</span>), <span class="at">members =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>))</span>
<span id="cb1-3"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb1-3" tabindex="-1"></a><span class="fu">class</span>(cluster) <span class="ot">&lt;-</span> <span class="st">&quot;Cluster&quot;</span></span>
<span id="cb1-4"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb1-5" tabindex="-1"></a><span class="co"># Define a method for the Cluster class</span></span>
<span id="cb1-6"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb1-6" tabindex="-1"></a>print.Cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(obj) {</span>
<span id="cb1-7"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb1-7" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Cluster centroid at:&quot;</span>, obj<span class="sc">$</span>centroid, <span class="st">&quot;</span></span>
<span id="cb1-8"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb1-8" tabindex="-1"></a><span class="st">&quot;</span>)</span>
<span id="cb1-9"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb1-9" tabindex="-1"></a>}</span>
<span id="cb1-10"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb1-11" tabindex="-1"></a><span class="co"># Use the method</span></span>
<span id="cb1-12"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb1-12" tabindex="-1"></a><span class="fu">print</span>(cluster)</span></code></pre></div>
</div>
<div id="rust-equivalent-using-structs-and-traits" class="section level3 hasAnchor" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> <strong>Rust Equivalent: Using Structs and Traits</strong><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#rust-equivalent-using-structs-and-traits" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb2-1"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-1" tabindex="-1"></a><span class="kw">struct</span> Cluster <span class="op">{</span></span>
<span id="cb2-2"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-2" tabindex="-1"></a>    centroid<span class="op">:</span> (<span class="dt">f64</span><span class="op">,</span> <span class="dt">f64</span>)<span class="op">,</span></span>
<span id="cb2-3"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-3" tabindex="-1"></a>    members<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u32</span><span class="op">&gt;,</span></span>
<span id="cb2-4"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-4" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-5"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-6" tabindex="-1"></a><span class="kw">impl</span> Cluster <span class="op">{</span></span>
<span id="cb2-7"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-7" tabindex="-1"></a>    <span class="kw">fn</span> print(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb2-8"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-8" tabindex="-1"></a>        <span class="pp">println!</span>(<span class="st">&quot;Cluster centroid at: {:?}&quot;</span><span class="op">,</span> <span class="kw">self</span><span class="op">.</span>centroid)<span class="op">;</span></span>
<span id="cb2-9"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-9" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-10"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-10" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-11"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-12" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb2-13"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-13" tabindex="-1"></a>    <span class="kw">let</span> cluster <span class="op">=</span> Cluster <span class="op">{</span></span>
<span id="cb2-14"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-14" tabindex="-1"></a>        centroid<span class="op">:</span> (<span class="dv">2.3</span><span class="op">,</span> <span class="dv">3.4</span>)<span class="op">,</span></span>
<span id="cb2-15"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-15" tabindex="-1"></a>        members<span class="op">:</span> <span class="pp">vec!</span>[<span class="dv">1</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">9</span>]<span class="op">,</span></span>
<span id="cb2-16"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-16" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb2-17"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-17" tabindex="-1"></a></span>
<span id="cb2-18"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-18" tabindex="-1"></a>    cluster<span class="op">.</span>print()<span class="op">;</span></span>
<span id="cb2-19"><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#cb2-19" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<div id="key-takeaways" class="section level3 hasAnchor" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> <strong>Key Takeaways</strong><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#key-takeaways" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>R uses lists and S3/S4 classes for OO design</strong>, whereas <strong>Rust uses structs and traits</strong>.</li>
<li><strong>Methods in R</strong> are just functions that check an objectâs class, while <strong>Rust uses <code>impl</code> blocks</strong> to define methods.</li>
<li><strong>Rust enforces type safety at compile time</strong>, while <strong>R allows more flexibility</strong> at the cost of runtime type checking.</li>
</ul>
<hr />
</div>
</div>
<div id="the-problem-clustering-expression-data-using-simulated-annealing" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> <strong>The Problem: Clustering Expression Data Using Simulated Annealing</strong><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#the-problem-clustering-expression-data-using-simulated-annealing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The algorithm we will implement is based on an <strong>R programming exercise</strong> given to students. It clusters gene expression data using <strong>simulated annealing</strong>, a probabilistic optimization method. This algorithm is <strong>simple to understand and implement</strong>, but it also touches on several <strong>important programming concepts</strong>, including:
- <strong>File reading</strong>
- <strong>Control flow (loops, conditionals)</strong>
- <strong>Data structures (vectors, matrices, hashes)</strong>
- <strong>Mathematical operations</strong>
- <strong>Performance considerations</strong></p>
<div id="the-data" class="section level3 hasAnchor" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> <strong>The Data</strong><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For this problem, we will use <strong>yeast cell-cycle data</strong>, which is a small <strong>time-course dataset</strong> consisting of <strong>250 genes across 16 timepoints</strong>. The data is available here:<br />
ð <a href="https://github.com/shambam/R_programming_1/blob/main/Spellman_Yeast_Cell_Cycle.tsv">Spellman_Yeast_Cell_Cycle.tsv</a></p>
<div id="biological-context" class="section level4 hasAnchor" number="1.3.1.1">
<h4><span class="header-section-number">1.3.1.1</span> <strong>Biological Context</strong><a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#biological-context" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Yeast in liquid culture were synchronized at the <strong>same cell-cycle phase</strong> and then released. They underwent <strong>two synchronized divisions</strong>, and samples were taken at <strong>16 timepoints</strong>. Since genes involved in the same biological processes tend to have similar expression patterns, this dataset contains <strong>distinct clusters of co-regulated genes</strong>. Our task is to <strong>cluster genes based on their expression profiles</strong> using simulated annealing.</p>
</div>
</div>
</div>
<div id="simulated-annealing" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> Simulated annealing<a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#simulated-annealing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can think of well clustered data having low energy, in that each cluster is tight and has little within cluster variance. If we calculate the variance <em>within</em> each cluster and sum over all clusters we get the total variance (energy) of the system. To measure the distance between two genes <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> over <span class="math inline">\(t\)</span> timepoints we do:</p>
<p><span class="math display">\[d_{ij}=\sqrt{\sum{(g^{i}_t-g^{j}_t)^2}}\]</span></p>
<p>so to measure the energy (total variance) of a clustering we sum the pairwise distances for each cluster <span class="math inline">\(K\)</span>, and then sum over all <span class="math inline">\(K\)</span>s and them divide by <span class="math inline">\(K\)</span>.</p>
<p><span class="math display">\[ E(K)=\frac{1}{K}\sum^K_{k=1} \left[ \sum_{i\epsilon Ck}\sum_{j\epsilon Ck} d_{ij}\right] \]</span></p>
<p>For a well clustered data, <span class="math inline">\(E(K)\)</span> should be as <strong>small</strong> as possible. Lets say we have 1000 genes, and we want to partition them into 10 clusters. The number of combinations is too high for us to try each one to brute force a true <span class="math inline">\(E\)</span>. This is why we use a <em>heuristic</em> algorithm to get us as close to the solution as possible in a smaller amount of time.</p>
<p>If we tried to visualise the energy landscape we can imagine it might look something like this:</p>
<p><img src="images/EnergyLandscape.png" width="60%" style="display: block; margin: auto;" /></p>
<p>The idea behind simulated annealing is that âbadâ moves are also allowed for a proportion of the iterations allowing exploration of the energy landscape, thereby avoiding local minima.</p>
</div>
<div id="the-algorithm" class="section level2 hasAnchor" number="1.5">
<h2><span class="header-section-number">1.5</span> The Algorithm<a href="using-rust-to-implement-the-simulated-annealing-algorithm.html#the-algorithm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I do not want to focus too much onto the algoirithm here as the main focus is on the Rust implementation, but the steps that need to be run are as follows:</p>
<ol style="list-style-type: decimal">
<li>Load the data and scale it so each geneâs value lie between 0 and 1</li>
<li>Create a random cluster information and calculate the energy of this clustering</li>
<li>Randomly shift any gene from itâs cluster to another</li>
<li>Calculate the new energy and check if the new cluster info should be kept; do that</li>
<li>Repeat 3 and 4 for n iterations</li>
<li>report the cluster information - if possible create plots</li>
</ol>
<p>And all of that in Rust ;-)</p>
<p><a href="variables---strict-types-and-ownership-in-rust.html" class="btn" id="next">Next â¡ï¸</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>

<a href="variables---strict-types-and-ownership-in-rust.html" class="navigation navigation-next navigation-unique" aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/USERNAME/REPO/edit/BRANCH/01-intro.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf", "_main.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
