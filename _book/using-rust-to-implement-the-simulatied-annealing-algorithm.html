<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Simulated Annealing in Rust</title>
  <meta name="description" content="<p>This Tutorial gives a short hands on example of how to read a table into Rust and run some calculations.
This should be a one day excercise and requires a previouse programming experience, but not necessarily Rust experience.</p>" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Simulated Annealing in Rust" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This Tutorial gives a short hands on example of how to read a table into Rust and run some calculations.
This should be a one day excercise and requires a previouse programming experience, but not necessarily Rust experience.</p>" />
  <meta name="github-repo" content="stela2502/tutorial_rust_simulated_annealing" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Simulated Annealing in Rust" />
  
  <meta name="twitter:description" content="<p>This Tutorial gives a short hands on example of how to read a table into Rust and run some calculations.
This should be a one day excercise and requires a previouse programming experience, but not necessarily Rust experience.</p>" />
  

<meta name="author" content="Stefan Lang" />


<meta name="date" content="2025-04-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  

<link rel="next" href="introduction.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>



<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="using-rust-to-implement-the-simulatied-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulatied-annealing-algorithm.html"><i class="fa fa-check"></i><b>1</b> Using Rust to Implement the Simulatied Annealing Algorithm</a>
<ul>
<li class="chapter" data-level="1.1" data-path="using-rust-to-implement-the-simulatied-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulatied-annealing-algorithm.html#the-problem"><i class="fa fa-check"></i><b>1.1</b> The Problem</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="using-rust-to-implement-the-simulatied-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulatied-annealing-algorithm.html#the-data"><i class="fa fa-check"></i><b>1.1.1</b> The Data</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="using-rust-to-implement-the-simulatied-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulatied-annealing-algorithm.html#simulated-annealing"><i class="fa fa-check"></i><b>1.2</b> Simulated annealing</a></li>
<li class="chapter" data-level="1.3" data-path="using-rust-to-implement-the-simulatied-annealing-algorithm.html"><a href="using-rust-to-implement-the-simulatied-annealing-algorithm.html#the-algorithm"><i class="fa fa-check"></i><b>1.3</b> The Algorithm</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#target-audience"><i class="fa fa-check"></i><b>2.1</b> Target Audience</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introduction.html"><a href="introduction.html#integers"><i class="fa fa-check"></i><b>2.1.1</b> Integers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="implementation.html"><a href="implementation.html"><i class="fa fa-check"></i><b>3</b> Implementation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="implementation.html"><a href="implementation.html#there-is-a-lot-of-new-stuff-in-this-function"><i class="fa fa-check"></i><b>3.1</b> There is a lot of new stuff in this function:</a></li>
<li class="chapter" data-level="3.2" data-path="implementation.html"><a href="implementation.html#add-a-test-for-this"><i class="fa fa-check"></i><b>3.2</b> Add a test for this</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="implement-the-simaulated-annealing-algorithm.html"><a href="implement-the-simaulated-annealing-algorithm.html"><i class="fa fa-check"></i><b>4</b> Implement the Simaulated Annealing Algorithm</a>
<ul>
<li class="chapter" data-level="4.1" data-path="implement-the-simaulated-annealing-algorithm.html"><a href="implement-the-simaulated-annealing-algorithm.html#scaling-of-the-data"><i class="fa fa-check"></i><b>4.1</b> scaling of the data</a></li>
<li class="chapter" data-level="4.2" data-path="implement-the-simaulated-annealing-algorithm.html"><a href="implement-the-simaulated-annealing-algorithm.html#calculating-cluster-energy"><i class="fa fa-check"></i><b>4.2</b> Calculating Cluster Energy</a></li>
<li class="chapter" data-level="4.3" data-path="implement-the-simaulated-annealing-algorithm.html"><a href="implement-the-simaulated-annealing-algorithm.html#the-main-function"><i class="fa fa-check"></i><b>4.3</b> The main function</a></li>
<li class="chapter" data-level="4.4" data-path="implement-the-simaulated-annealing-algorithm.html"><a href="implement-the-simaulated-annealing-algorithm.html#and-funtions-to-plot-and-write-the-data"><i class="fa fa-check"></i><b>4.4</b> And Funtions to Plot and Write the Data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="main.html"><a href="main.html"><i class="fa fa-check"></i><b>5</b> main.rs</a></li>
<li class="chapter" data-level="6" data-path="sharing-your-book.html"><a href="sharing-your-book.html"><i class="fa fa-check"></i><b>6</b> Sharing your book</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sharing-your-book.html"><a href="sharing-your-book.html#publishing"><i class="fa fa-check"></i><b>6.1</b> Publishing</a></li>
<li class="chapter" data-level="6.2" data-path="sharing-your-book.html"><a href="sharing-your-book.html#pages"><i class="fa fa-check"></i><b>6.2</b> 404 pages</a></li>
<li class="chapter" data-level="6.3" data-path="sharing-your-book.html"><a href="sharing-your-book.html#metadata-for-sharing"><i class="fa fa-check"></i><b>6.3</b> Metadata for sharing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="7" data-path="error-handling.html"><a href="error-handling.html"><i class="fa fa-check"></i><b>7</b> Error Handling in Rust</a>
<ul>
<li class="chapter" data-level="7.1" data-path="error-handling.html"><a href="error-handling.html#unrecoverable-errors-panic"><i class="fa fa-check"></i><b>7.1</b> 1. Unrecoverable Errors (<code>panic!</code>)</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="error-handling.html"><a href="error-handling.html#example"><i class="fa fa-check"></i><b>7.1.1</b> Example:</a></li>
<li class="chapter" data-level="7.1.2" data-path="error-handling.html"><a href="error-handling.html#when-to-use-panic"><i class="fa fa-check"></i><b>7.1.2</b> When to Use <code>panic!()</code></a></li>
<li class="chapter" data-level="7.1.3" data-path="error-handling.html"><a href="error-handling.html#handling-panics-gracefully"><i class="fa fa-check"></i><b>7.1.3</b> Handling Panics Gracefully</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="error-handling.html"><a href="error-handling.html#recoverable-errors-resultt-e"><i class="fa fa-check"></i><b>7.2</b> 2. Recoverable Errors (<code>Result&lt;T, E&gt;</code>)</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="error-handling.html"><a href="error-handling.html#example-1"><i class="fa fa-check"></i><b>7.2.1</b> Example:</a></li>
<li class="chapter" data-level="7.2.2" data-path="error-handling.html"><a href="error-handling.html#resultt-e-explanation"><i class="fa fa-check"></i><b>7.2.2</b> <code>Result&lt;T, E&gt;</code> Explanation</a></li>
<li class="chapter" data-level="7.2.3" data-path="error-handling.html"><a href="error-handling.html#common-ways-to-handle-resultt-e"><i class="fa fa-check"></i><b>7.2.3</b> Common Ways to Handle <code>Result&lt;T, E&gt;</code></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="error-handling.html"><a href="error-handling.html#custom-errors-with-thiserror-and-anyhow"><i class="fa fa-check"></i><b>7.3</b> 3. Custom Errors with <code>thiserror</code> and <code>anyhow</code></a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="error-handling.html"><a href="error-handling.html#using-thiserror-for-custom-errors"><i class="fa fa-check"></i><b>7.3.1</b> Using <code>thiserror</code> for Custom Errors</a></li>
<li class="chapter" data-level="7.3.2" data-path="error-handling.html"><a href="error-handling.html#using-anyhow-for-simpler-error-handling"><i class="fa fa-check"></i><b>7.3.2</b> Using <code>anyhow</code> for Simpler Error Handling</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="error-handling.html"><a href="error-handling.html#summary-of-rust-error-handling-techniques"><i class="fa fa-check"></i><b>7.4</b> Summary of Rust Error Handling Techniques</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="testing.html"><a href="testing.html"><i class="fa fa-check"></i><b>8</b> Testing in Rust</a>
<ul>
<li class="chapter" data-level="8.1" data-path="testing.html"><a href="testing.html#writing-basic-unit-tests"><i class="fa fa-check"></i><b>8.1</b> 1. Writing Basic Unit Tests</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="testing.html"><a href="testing.html#example-2"><i class="fa fa-check"></i><b>8.1.1</b> Example:</a></li>
<li class="chapter" data-level="8.1.2" data-path="testing.html"><a href="testing.html#common-assertions"><i class="fa fa-check"></i><b>8.1.2</b> Common Assertions:</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="testing.html"><a href="testing.html#running-tests"><i class="fa fa-check"></i><b>8.2</b> 2. Running Tests</a></li>
<li class="chapter" data-level="8.3" data-path="testing.html"><a href="testing.html#testing-for-panics"><i class="fa fa-check"></i><b>8.3</b> 3. Testing for Panics</a></li>
<li class="chapter" data-level="8.4" data-path="testing.html"><a href="testing.html#using-resultt-e-in-tests"><i class="fa fa-check"></i><b>8.4</b> 4. Using <code>Result&lt;T, E&gt;</code> in Tests</a></li>
<li class="chapter" data-level="8.5" data-path="testing.html"><a href="testing.html#ignoring-tests"><i class="fa fa-check"></i><b>8.5</b> 5. Ignoring Tests</a></li>
<li class="chapter" data-level="8.6" data-path="testing.html"><a href="testing.html#benchmarking-with-bench"><i class="fa fa-check"></i><b>8.6</b> 6. Benchmarking with <code>#[bench]</code></a></li>
<li class="chapter" data-level="8.7" data-path="testing.html"><a href="testing.html#integration-tests"><i class="fa fa-check"></i><b>8.7</b> 7. Integration Tests</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="testing.html"><a href="testing.html#example-testsintegration_test.rs"><i class="fa fa-check"></i><b>8.7.1</b> Example <code>tests/integration_test.rs</code>:</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="testing.html"><a href="testing.html#testing-the-executable"><i class="fa fa-check"></i><b>8.8</b> 8. Testing the Executable</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="testing.html"><a href="testing.html#example-teststest_binary.rs"><i class="fa fa-check"></i><b>8.8.1</b> Example <code>tests/test_binary.rs</code>:</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="testing.html"><a href="testing.html#summary"><i class="fa fa-check"></i><b>8.9</b> Summary</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Simulated Annealing in Rust</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Simulated Annealing in Rust</h1>
<p class="author"><em>Stefan Lang</em></p>
<p class="date"><em>2025-04-02</em></p>
</div>
<div id="using-rust-to-implement-the-simulatied-annealing-algorithm" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">Chapter 1</span> Using Rust to Implement the Simulatied Annealing Algorithm<a href="using-rust-to-implement-the-simulatied-annealing-algorithm.html#using-rust-to-implement-the-simulatied-annealing-algorithm" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This tutorial is for experienced Bioinformaticians that have been programming in R and/or Python or comparable scripting languages. It does of cause not hurt if you program in C, C++ or Julia either.</p>
<div id="the-problem" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> The Problem<a href="using-rust-to-implement-the-simulatied-annealing-algorithm.html#the-problem" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The algorithm I have decided to use is the one given to my students on the R programming I course. It is clustering expression data using simulated annealing. It’s a simple algorithm to understand and program, but is has enough scope where solutions can vary widely. It also contains what most of what we need to know about a language, file reading, control flow, containers, maths etc.</p>
<div id="the-data" class="section level3 hasAnchor" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> The Data<a href="using-rust-to-implement-the-simulatied-annealing-algorithm.html#the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For this problem we will use yeast cell-cycle data which is small timecourse dataset of 250 genes and 16 timepoints. You can get the data <a href="https://github.com/shambam/R_programming_1/blob/main/Spellman_Yeast_Cell_Cycle.tsv">here</a>. Yeast in liquid culture have been arrested at the same point in cell-cycle, and then released so they undergo two cell divisions in synchrony. They were sampled at 16 timepoints and then arrayed. This means there are some nice looking clusters in the data and will be clear if your implementation is working.</p>
</div>
</div>
<div id="simulated-annealing" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Simulated annealing<a href="using-rust-to-implement-the-simulatied-annealing-algorithm.html#simulated-annealing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can think of well clustered data having low energy, in that each cluster is tight and has little within cluster variance. If we calculate the variance <em>within</em> each cluster and sum over all clusters we get the total variance (energy) of the system. To measure the distance between two genes <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> over <span class="math inline">\(t\)</span> timepoints we do:</p>
<p><span class="math display">\[d_{ij}=\sqrt{\sum{(g^{i}_t-g^{j}_t)^2}}\]</span></p>
<p>so to measure the energy (total variance) of a clustering we sum the pairwise distances for each cluster <span class="math inline">\(K\)</span>, and then sum over all <span class="math inline">\(K\)</span>s and them divide by <span class="math inline">\(K\)</span>.</p>
<p><span class="math display">\[ E(K)=\frac{1}{K}\sum^K_{k=1} \left[ \sum_{i\epsilon Ck}\sum_{j\epsilon Ck} d_{ij}\right] \]</span></p>
<p>For a well clustered data, <span class="math inline">\(E(K)\)</span> should be as <strong>small</strong> as possible. Lets say we have 1000 genes, and we want to partition them into 10 clusters. The number of combinations is too high for us to try each one to brute force a true <span class="math inline">\(E\)</span>. This is why we use a <em>heuristic</em> algorithm to get us as close to the solution as possible in a smaller amount of time.</p>
<p>If we tried to visualise the energy landscape we can imagine it might look something like this:</p>
<p><img src="images/EnergyLandscape.png" width="60%" style="display: block; margin: auto;" /></p>
<p>The idea behind simulated annealing is that “bad” moves are also allowed for a proportion of the iterations allowing exploration of the energy landscape, thereby avoiding local minima.</p>
</div>
<div id="the-algorithm" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> The Algorithm<a href="using-rust-to-implement-the-simulatied-annealing-algorithm.html#the-algorithm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I do not want to focus too much onto the algoirithm here as the main forcus is on the Rust implementation, but the steps that need to be run are as follows:</p>
<ol style="list-style-type: decimal">
<li>Load the data and scale it so each gene’s value lie between 0 and 1</li>
<li>Create a random cluster information and calculate the energy of this clustering</li>
<li>Randomly shift any gene from it’s cluster to another</li>
<li>Calculate the new energy and check if the new cluster info should be kept; do that</li>
<li>Repeat 3 and 4 until for n iterations</li>
<li>report the cluster information - if possible create plots</li>
</ol>
<p>And all of that in Rust ;-)</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>

<a href="introduction.html" class="navigation navigation-next navigation-unique" aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/USERNAME/REPO/edit/BRANCH/01-intro.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf", "_main.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
